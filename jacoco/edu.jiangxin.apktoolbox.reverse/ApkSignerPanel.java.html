<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApkSignerPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ApkToolBoxGUI</a> &gt; <a href="index.source.html" class="el_package">edu.jiangxin.apktoolbox.reverse</a> &gt; <span class="el_source">ApkSignerPanel.java</span></div><h1>ApkSignerPanel.java</h1><pre class="source lang-java linenums">package edu.jiangxin.apktoolbox.reverse;

import edu.jiangxin.apktoolbox.swing.extend.listener.SelectFileListener;
import edu.jiangxin.apktoolbox.swing.extend.plugin.PluginPanel;
import edu.jiangxin.apktoolbox.utils.Constants;
import edu.jiangxin.apktoolbox.utils.Utils;
import org.apache.commons.lang3.StringUtils;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

/**
 * @author jiangxin
 * @author 2019-04-12
 *
 */
public class ApkSignerPanel extends PluginPanel {

    private static final long serialVersionUID = 1L;

    private JTextField apkPathTextField;

    private JTextField keyStorePathTextField;

    private JPasswordField keyStorePasswordField;

    private JTextField aliasTextField;

    private JPasswordField aliasPasswordField;

    public ApkSignerPanel() throws HeadlessException {
<span class="nc" id="L34">        super();</span>
<span class="nc" id="L35">    }</span>

    @Override
    public String getPluginFilename() {
<span class="nc" id="L39">        return &quot;apksigner.jar&quot;;</span>
    }

    @Override
    public void initUI() {
<span class="nc" id="L44">        BoxLayout boxLayout = new BoxLayout(this, BoxLayout.Y_AXIS);</span>
<span class="nc" id="L45">        setLayout(boxLayout);</span>

<span class="nc" id="L47">        createApkPathPanel();</span>
<span class="nc" id="L48">        add(Box.createVerticalStrut(Constants.DEFAULT_Y_BORDER));</span>

<span class="nc" id="L50">        createKeyStorePathPanel();</span>
<span class="nc" id="L51">        add(Box.createVerticalStrut(Constants.DEFAULT_Y_BORDER));</span>

<span class="nc" id="L53">        createKeyStorePasswordPanel();</span>
<span class="nc" id="L54">        add(Box.createVerticalStrut(Constants.DEFAULT_Y_BORDER));</span>

<span class="nc" id="L56">        createAliasPanel();</span>
<span class="nc" id="L57">        add(Box.createVerticalStrut(Constants.DEFAULT_Y_BORDER));</span>

<span class="nc" id="L59">        createAliasPasswordPanel();</span>
<span class="nc" id="L60">        add(Box.createVerticalStrut(Constants.DEFAULT_Y_BORDER));</span>

<span class="nc" id="L62">        createOptionPanel();</span>
<span class="nc" id="L63">    }</span>

    private void createOptionPanel() {
<span class="nc" id="L66">        JPanel operationPanel = new JPanel();</span>
<span class="nc" id="L67">        operationPanel.setLayout(new BoxLayout(operationPanel, BoxLayout.X_AXIS));</span>
<span class="nc" id="L68">        add(operationPanel);</span>

<span class="nc" id="L70">        JButton recoverButton = new JButton(&quot;recover&quot;);</span>
<span class="nc" id="L71">        recoverButton.addActionListener(new RecoverButtonActionListener());</span>

<span class="nc" id="L73">        JButton apkSignButton = new JButton(&quot;apksigner&quot;);</span>
<span class="nc" id="L74">        apkSignButton.addActionListener(new ApkSignButtonActionListener());</span>

<span class="nc" id="L76">        operationPanel.add(recoverButton);</span>
<span class="nc" id="L77">        operationPanel.add(Box.createHorizontalStrut(Constants.DEFAULT_X_BORDER));</span>
<span class="nc" id="L78">        operationPanel.add(apkSignButton);</span>
<span class="nc" id="L79">    }</span>

    private void createAliasPasswordPanel() {
<span class="nc" id="L82">        JPanel aliasPasswordPanel = new JPanel();</span>
<span class="nc" id="L83">        aliasPasswordPanel.setLayout(new BoxLayout(aliasPasswordPanel, BoxLayout.X_AXIS));</span>
<span class="nc" id="L84">        add(aliasPasswordPanel);</span>
        
<span class="nc" id="L86">        aliasPasswordField = new JPasswordField();</span>
<span class="nc" id="L87">        aliasPasswordField.setText(conf.getString(&quot;apksigner.alias.password&quot;));</span>

<span class="nc" id="L89">        JLabel aliasPasswordLable = new JLabel(&quot;Alias Password&quot;);</span>

<span class="nc" id="L91">        aliasPasswordPanel.add(aliasPasswordField);</span>
<span class="nc" id="L92">        aliasPasswordPanel.add(Box.createHorizontalStrut(Constants.DEFAULT_X_BORDER));</span>
<span class="nc" id="L93">        aliasPasswordPanel.add(aliasPasswordLable);</span>
<span class="nc" id="L94">    }</span>

    private void createAliasPanel() {
<span class="nc" id="L97">        JPanel aliasPanel = new JPanel();</span>
<span class="nc" id="L98">        aliasPanel.setLayout(new BoxLayout(aliasPanel, BoxLayout.X_AXIS));</span>
<span class="nc" id="L99">        add(aliasPanel);</span>
        
<span class="nc" id="L101">        aliasTextField = new JTextField();</span>
<span class="nc" id="L102">        aliasTextField.setText(conf.getString(&quot;apksigner.alias&quot;));</span>

<span class="nc" id="L104">        JLabel aliasLable = new JLabel(&quot;Alias&quot;);</span>

<span class="nc" id="L106">        aliasPanel.add(aliasTextField);</span>
<span class="nc" id="L107">        aliasPanel.add(Box.createHorizontalStrut(Constants.DEFAULT_X_BORDER));</span>
<span class="nc" id="L108">        aliasPanel.add(aliasLable);</span>
<span class="nc" id="L109">    }</span>

    private void createKeyStorePasswordPanel() {
<span class="nc" id="L112">        JPanel keyStorePasswordPanel = new JPanel();</span>
<span class="nc" id="L113">        keyStorePasswordPanel.setLayout(new BoxLayout(keyStorePasswordPanel, BoxLayout.X_AXIS));</span>
<span class="nc" id="L114">        add(keyStorePasswordPanel);</span>
        
<span class="nc" id="L116">        keyStorePasswordField = new JPasswordField();</span>
<span class="nc" id="L117">        keyStorePasswordField.setText(conf.getString(&quot;apksigner.keystore.password&quot;));</span>

<span class="nc" id="L119">        JLabel keyStorePasswordLable = new JLabel(&quot;KeyStore Password&quot;);</span>

<span class="nc" id="L121">        keyStorePasswordPanel.add(keyStorePasswordField);</span>
<span class="nc" id="L122">        keyStorePasswordPanel.add(Box.createHorizontalStrut(Constants.DEFAULT_X_BORDER));</span>
<span class="nc" id="L123">        keyStorePasswordPanel.add(keyStorePasswordLable);</span>
<span class="nc" id="L124">    }</span>

    private void createKeyStorePathPanel() {
<span class="nc" id="L127">        JPanel keyStorePathPanel = new JPanel();</span>
<span class="nc" id="L128">        keyStorePathPanel.setLayout(new BoxLayout(keyStorePathPanel, BoxLayout.X_AXIS));</span>
<span class="nc" id="L129">        add(keyStorePathPanel);</span>
        
<span class="nc" id="L131">        keyStorePathTextField = new JTextField();</span>
<span class="nc" id="L132">        keyStorePathTextField.setText(conf.getString(&quot;apksigner.keystore.path&quot;));</span>

<span class="nc" id="L134">        JButton keyStorePathButton = new JButton(&quot;Select KeyStore&quot;);</span>
<span class="nc" id="L135">        keyStorePathButton.addActionListener(new SelectFileListener(&quot;select a keystore file&quot;, keyStorePathTextField));</span>

<span class="nc" id="L137">        keyStorePathPanel.add(keyStorePathTextField);</span>
<span class="nc" id="L138">        keyStorePathPanel.add(Box.createHorizontalStrut(Constants.DEFAULT_X_BORDER));</span>
<span class="nc" id="L139">        keyStorePathPanel.add(keyStorePathButton);</span>
<span class="nc" id="L140">    }</span>

    private void createApkPathPanel() {
<span class="nc" id="L143">        JPanel apkPathPanel = new JPanel();</span>
<span class="nc" id="L144">        apkPathPanel.setLayout(new BoxLayout(apkPathPanel, BoxLayout.X_AXIS));</span>
<span class="nc" id="L145">        add(apkPathPanel);</span>

<span class="nc" id="L147">        apkPathTextField = new JTextField();</span>
<span class="nc" id="L148">        apkPathTextField.setText(conf.getString(&quot;apksigner.apk.path&quot;));</span>

<span class="nc" id="L150">        JButton apkPathButton = new JButton(&quot;Select APK&quot;);</span>
<span class="nc" id="L151">        apkPathButton.addActionListener(new SelectFileListener(&quot;select a APK file&quot;, apkPathTextField));</span>

<span class="nc" id="L153">        apkPathPanel.add(apkPathTextField);</span>
<span class="nc" id="L154">        apkPathPanel.add(Box.createHorizontalStrut(Constants.DEFAULT_X_BORDER));</span>
<span class="nc" id="L155">        apkPathPanel.add(apkPathButton);</span>
<span class="nc" id="L156">    }</span>
    
<span class="nc" id="L158">    private final class RecoverButtonActionListener implements ActionListener {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L161">            keyStorePathTextField.setText(conf.getString(&quot;default.apksigner.keystore.path&quot;));</span>
<span class="nc" id="L162">            keyStorePasswordField.setText(conf.getString(&quot;default.apksigner.keystore.password&quot;));</span>
<span class="nc" id="L163">            aliasTextField.setText(conf.getString(&quot;default.apksigner.alias&quot;));</span>
<span class="nc" id="L164">            aliasPasswordField.setText(&quot;default.apksigner.alias.password&quot;);</span>
<span class="nc" id="L165">        }</span>
    }

<span class="nc" id="L168">    private final class ApkSignButtonActionListener implements ActionListener {</span>

        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L172">            String apkPath = checkAndGetFileContent(apkPathTextField, &quot;apksigner.apk.path&quot;, &quot;apk file is invalid&quot;);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (StringUtils.isEmpty(apkPath)) {</span>
<span class="nc" id="L174">                return;</span>
            }

<span class="nc" id="L177">            String keystorePath = checkAndGetFileContent(keyStorePathTextField, &quot;apksigner.keystore.path&quot;, &quot;keystore file is invalid&quot;);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (StringUtils.isEmpty(keystorePath)) {</span>
<span class="nc" id="L179">                return;</span>
            }

<span class="nc" id="L182">            String keystorePassword = checkAndGetStringContent(keyStorePasswordField, &quot;apksigner.keystore.password&quot;, &quot;keystorePassword is invalid&quot;);</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">            if (StringUtils.isEmpty(keystorePassword)) {</span>
<span class="nc" id="L184">                return;</span>
            }

<span class="nc" id="L187">            String alias = checkAndGetStringContent(aliasTextField, &quot;apksigner.alias&quot;, &quot;alias is invalid&quot;);</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">            if (StringUtils.isEmpty(alias)) {</span>
<span class="nc" id="L189">                return;</span>
            }

<span class="nc" id="L192">            String aliasPassword = checkAndGetStringContent(aliasPasswordField, &quot;apksigner.alias.password&quot;, &quot;aliasPassword is invalid&quot;);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">            if (StringUtils.isEmpty(aliasPassword)) {</span>
<span class="nc" id="L194">                return;</span>
            }

<span class="nc" id="L197">            StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L198">            sb.append(getPluginStartupCmd())</span>
<span class="nc" id="L199">                    .append(&quot; -keystore &quot;).append(keystorePath).append(&quot; -pswd &quot;).append(keystorePassword)</span>
<span class="nc" id="L200">                    .append(&quot; -alias &quot;).append(alias).append(&quot; -aliaspswd &quot;).append(aliasPassword).append(&quot; &quot;)</span>
<span class="nc" id="L201">                    .append(apkPath);</span>

<span class="nc" id="L203">            Utils.executor(sb.toString(), true);</span>
<span class="nc" id="L204">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>